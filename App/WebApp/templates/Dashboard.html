{% load static %}
{% include 'reusable.html' %}
<title>RTO - II, Dashboard</title>
<body class="sidebar-mini layout-fixed sidebar-collapse">
<div class="wrapper">

    <!-- Navbar Starts Here -->
    {% include 'navbar.html' %}
    <!-- /.Navbar Ends Here -->
    <!-- SideBar Start Here  -->
    {% include 'sidebar.html' %}
    <!-- SideBar Ends Here  -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1 class="m-0">RTO - II, Dashboard</h1>
                    </div><!-- /.col -->
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="#" style="color:black"><i class="fa fa-home"></i></a>
                            </li>
                            <li class="breadcrumb-item active">Dashboard</li>
                        </ol>
                    </div><!-- /.col -->
                </div><!-- /.row -->
            </div><!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <section class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="far fa-envelope"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">Messages</span>
                                <span class="info-box-number">1,410</span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box">
                            <span class="info-box-icon bg-success"><i class="far fa-flag"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">Bookmarks</span>
                                <span class="info-box-number">410</span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box">
                            <span class="info-box-icon bg-warning"><i class="far fa-copy"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">Uploads</span>
                                <span class="info-box-number">13,648</span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                    <div class="col-md-3 col-sm-6 col-12">
                        <div class="info-box">
                            <span class="info-box-icon bg-danger"><i class="far fa-star"></i></span>

                            <div class="info-box-content">
                                <span class="info-box-text">Likes</span>
                                <span class="info-box-number">93,139</span>
                            </div>
                            <!-- /.info-box-content -->
                        </div>
                        <!-- /.info-box -->
                    </div>
                    <!-- /.col -->
                </div>

                <div class="row" style="display:none">
                    <div class="col-lg-12">
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">Disposition List, Regional Tax Office - II</h3>

                                        <div class="card-tools">
                                            <div class="input-group input-group-sm" style="width: 150px;">
                                                <input type="text" name="table_search" class="form-control float-right"
                                                       placeholder="Search">

                                                <div class="input-group-append">
                                                    <button type="submit" class="btn btn-default">
                                                        <i class="fas fa-search"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- /.card-header -->
                                    <div class="card-body table-responsive p-0" style="height: 400px;">
                                        <table class="table table-head-fixed text-nowrap table-striped">
                                            <thead>
                                            <tr>
                                                <th>S#</th>
                                                <th>Designation</th>
                                                <th>Total #</th>
                                                <th>View</th>

                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for result in results %}
                                            <tr>
                                                <td>{{ forloop.counter }}</td>
                                                <td>{{ result.trimmed_designation }}</td>
                                                <td>{{ result.total }}</td>
                                                <td><a href="/view"> View </a></td>


                                            </tr>
                                            {% endfor %}
                                            </tbody>

                                        </table>

                                    </div>
                                    <!-- /.card-body -->

                                </div>
                                <!-- /.card -->
                            </div>
                        </div>
                    </div>

                </div>


            </div>

            <div class="row">
                {% if message %}
                <script>
                            Swal.fire({
                                title: " {{ title }}",
                                text: " {{ message }}",
                                icon: "{{ icon }}"
                            });











                </script>
                {% endif %}
            </div>


        </section>

        <div class="container-fluid col-lg-12">
            {% include 'retired.html' with retired=retired%}
        </div>

        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Employee Retirement Chart Zone Wise, Regional Tax Office - II</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="retirementChart" width="200" height="80"></canvas>

                        </div>
                    </div>

                </div>
                <div class="col-lg-6">
                    {% include 'graph.html' with results=results %}
                </div>


            </div>


        </div>


        <div class="container-fluid col-lg-12">

        </div>
    </div>
    <!-- Content Wrapper. Contains page content  Ends Here -->


</div>
<!-- /.content-wrapper -->


{% include 'footer.html' %}

</div>

</body>

<script>
    // Convert Django context variables to JavaScript variables
    const zones = {{ zones|safe }};
    const counts = {{ counts|safe }};

    // Function to generate a random color
    function getRandomColor() {
        const letters = '0123456789ABCDEF';
        let color = '#';
        for (let i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
        }
        return color;
    }

    // Generate a color for each data point
    const backgroundColors = counts.map(() => getRandomColor());

    // Set up the chart data and configuration
    const ctx = document.getElementById('retirementChart').getContext('2d');
    const retirementChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: zones,
            datasets: [{
                label: '# of Retirements',
                data: counts,
                backgroundColor: backgroundColors,  // Dynamic colors
                borderColor: backgroundColors.map(color => color.replace('0.2', '1')),  // Optional: use the same colors for borders
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed !== null) {
                                label += context.parsed.toLocaleString();
                            }
                            return label;
                        }
                    }
                }
            }
        }
    });






</script>
