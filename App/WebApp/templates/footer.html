{% load static %}
<footer class="main-footer">
    <!-- To the right -->
    <div class="float-right d-none d-sm-inline">

    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2024-2025 <a href="#">RTO - II , Karachi </a>.</strong> All rights reserved.
</footer>


<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js ' %}"></script>
<!-- jQuery UI 1.11.4 -->
<script src="{% static 'plugins/jquery-ui/jquery-ui.min.js ' %}"></script>
<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->

<!-- Bootstrap 4 -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js ' %}"></script>
<!-- ChartJS -->
<script src="{% static 'plugins/chart.js/Chart.min.js ' %}"></script>
<!-- Sparkline -->
<script src="{% static 'plugins/sparklines/sparkline.js ' %}"></script>
<!-- JQVMap -->
<script src="{% static 'plugins/jqvmap/jquery.vmap.min.js ' %}"></script>
<script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js ' %}"></script>
<!-- jQuery Knob Chart -->
<script src="{% static 'plugins/jquery-knob/jquery.knob.min.js ' %}"></script>
<!-- daterangepicker -->
<script src="{% static 'plugins/moment/moment.min.js ' %}"></script>
<script src="{% static 'plugins/daterangepicker/daterangepicker.js ' %}"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js ' %}"></script>
<!-- Summernote -->
<script src="{% static 'plugins/summernote/summernote-bs4.min.js ' %}"></script>
<!-- overlayScrollbars -->
<script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js ' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'dist/js/adminlte.js ' %}"></script>
<!-- AdminLTE for demo purposes -->
<!--<script src="{% static 'dist/js/demo.js ' %}"></script>-->
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'dist/js/pages/dashboard.js ' %}"></script>

<!-- Select2 -->
<script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>


<!-- LightGallery core JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery-all.min.js"></script>

<!-- LightGallery Zoom Plugin -->
<script src="https://cdn.jsdelivr.net/npm/lg-zoom@1.0.0/dist/lg-zoom.min.js"></script>

<!-- LightGallery Rotate Plugin -->
<script src="https://cdn.jsdelivr.net/npm/lg-rotate@1.0.0/dist/lg-rotate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


<script>
    // Add search functionality
    document.getElementById('tableSearch').addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const rows = document.querySelectorAll('#zoneTable tbody tr');

        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const matches = Array.from(cells).some(cell => cell.textContent.toLowerCase().includes(searchTerm));
            row.style.display = matches ? '' : 'none';
        });
    });

    // Highlight row on hover
    document.querySelectorAll('#zoneTable tbody tr').forEach(row => {
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f2f2f2';
        });
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });


</script>

<!--Light gallery -->
<script type="text/javascript">
    $(document).ready(function() {
        $('.lightgallery').lightGallery({
            selector: '.spnImg',
            thumbnail: false

        });
    });
</script>
<!--Light gallery Ends Here -->

<!--Select 2 Option -->
<script>
    $(document).ready(function () {
       $("select").select2();
    });

</script>
<!--Select 2 Option Ends Here -->

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // Designation WISE Data using Group By
    const designationData = {
        labels: [
            {% for item in results %}
            "{{ item.trimmed_designation }}"{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        datasets: [{
            label: 'Total Strength #',
            data: [
                {% for item in results %}
                {{ item.total }}{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            backgroundColor: generateRandomColors({{ results|length }}),
            borderColor: 'rgba(0, 0, 0, 0.2)',
            borderWidth: 2
        }]
    };

    const designationChart = document.getElementById('designationChart').getContext('2d');
    new Chart(designationChart, {
        type: 'bar',
        data: designationData,
        options: {
            scales: {
                x: {
                    beginAtZero: true
                },
                y: {
                    beginAtZero: true
                }
            },
            animation: {
                duration: 1000, // Animation duration in ms
                easing: 'easeInOutBounce' // Easing effect
            }
        }
    });

    // Retirement ZONE WISE Data using Group By
    const zones = {{ zones|safe }};
    const counts = {{ counts|safe }};

    const retirementChart = document.getElementById('retirementChart').getContext('2d');
    new Chart(retirementChart, {
        type: {% if request.user.is_superuser == 1 %} 'bar' {% else %} 'doughnut' {% endif %},
        data: {
            labels: zones,
            datasets: [{
                label: '# of Retirements',
                data: counts.map(count => parseFloat(count)),
                backgroundColor: generateRandomColors(counts.length),
                borderColor: 'rgba(0, 0, 0, 0.2)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    enabled: true
                }
            },
            animation: {
                duration: 1500, // Animation duration in ms
                easing: 'easeInOutQuart' // Easing effect
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // Leave Summary Data
    const userType = '{{ request.user.is_superuser }}';
    const leaveSummary = {{ leave_summary|safe }};
    const ctx = document.getElementById('leaveSummary').getContext('2d');

    if (userType == 'True') {
        // Admin-specific logic for grouped bar chart
        const labels = ['Casual Leave', 'Earned Leave', 'Ex-Pakistan Leave', 'Medical Leave','Maternity Leave','Study Leave','Special Leave'];
        const datasets = Object.keys(leaveSummary).map(zone => ({
            label: zone,
            data: [
                leaveSummary[zone].casual_leave.count,
                leaveSummary[zone].earned_leave.count,
                leaveSummary[zone].ex_pakistan_leave.count,
                leaveSummary[zone].medical_leave.count,
                leaveSummary[zone].maternity_leave.count,
                leaveSummary[zone].study_leave.count,
                leaveSummary[zone].special_leave.count,

            ],
            backgroundColor: generateRandomColors(3)
        }));

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: datasets
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Leave Summary by Zone (Admin View)'
                    }
                },
                animation: {
                    duration: 1200, // Animation duration in ms
                    easing: 'easeOutBounce' // Easing effect
                },
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    } else {
        // Employee-specific logic for doughnut chart
        console.log(leaveSummary)
        const chartData = {
            labels: ['Casual Leave', 'Earned Leave', 'Ex-Pakistan Leave', 'Medical Leave', 'Maternity Leave', 'Study Leave', 'Special Leave'],
            datasets: [{
                label: 'Leave Count',
                data: [
                    leaveSummary.casual_leave.count,
                    leaveSummary.earned_leave.count,
                    leaveSummary.ex_pakistan_leave.count,
                    leaveSummary.medical_leave.count,
                    leaveSummary.maternity_leave.count,
                    leaveSummary.study_leave.count,
                    leaveSummary.special_leave.count,

                ],
                backgroundColor: generateRandomColors(3)
            }]
        };

        new Chart(ctx, {
            type: 'doughnut',
            data: chartData,
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Your Leave Summary (Employee View)'
                    }
                },
                animation: {
                    duration: 1300, // Animation duration in ms
                    easing: 'easeInOutCubic' // Easing effect
                }
            }
        });
    }

    // Function to generate random colors
    function generateRandomColors(count) {
        const colors = [];
        for (let i = 0; i < count; i++) {
            const randomColor = 'rgba(' +
                Math.floor(Math.random() * 256) + ',' +
                Math.floor(Math.random() * 256) + ',' +
                Math.floor(Math.random() * 256) + ',' +
                '0.5)';
            colors.push(randomColor);
        }
        return colors;
    }
});

</script>


